# Claude 验收检查清单

> **目标**：为 Claude 提供明确的代码验收标准，确保 Coder 输出的代码在进入测试阶段前已达到基本质量要求。

---

## 一、Claude 验收的定位

### 1.1 在 CCG 工作流中的位置

```
Coder 执行
    ↓
【Claude 快速验收】← 第一道人工检查
    ↓
通过 → 运行测试
不通过 → Claude 修复或重新委托 Coder
```

### 1.2 Claude 验收 vs Codex 审核

| 维度 | Claude 验收 | Codex 审核 |
|------|------------|-----------|
| **时机** | Coder 执行后立即进行 | 测试通过后进行 |
| **目标** | 快速发现明显问题 | 深度审核代码质量 |
| **深度** | 浅层检查（5-10 分钟） | 深度审核（15-30 分钟） |
| **标准** | 基本质量标准 | 严格质量标准（8 条 Blocking 规则） |
| **结果** | 通过/修复 | 通过/建议优化/需要修改 |

### 1.3 Claude 验收的价值

**快速发现明显问题**：
- ✅ Scope 超出（做了不该做的）
- ✅ 代码风格明显违规
- ✅ 缺少必要的测试
- ✅ 明显的逻辑错误

**避免浪费测试和审核时间**：
- 如果代码有明显问题，直接在 Claude 验收阶段修复
- 避免运行测试后才发现基本问题
- 避免 Codex 审核时发现大量低级问题

---

## 二、Claude 验收检查清单

### 2.1 Contract 符合性检查（Blocking）

**如果存在 Contract，必须检查以下项目**：

#### ✅ Scope 检查
```markdown
- [ ] 是否只修改了 Contract 中列出的文件？
- [ ] 是否只实现了 Contract 中定义的功能？
- [ ] 是否没有添加 Contract 之外的新功能？
```

**检查方法**：
1. 对比 `git diff` 输出和 Contract 的 Scope
2. 确认所有改动都在 Scope 范围内

**不通过示例**：
- ❌ Contract 只要求修改 `user.py`，但也修改了 `admin.py`
- ❌ Contract 只要求实现登录，但也实现了注册功能

#### ✅ Must-not-change 检查
```markdown
- [ ] 是否保持了 Contract 中列出的不能改变的行为？
- [ ] 是否没有破坏现有的 API 接口？
- [ ] 是否保持了向后兼容性？
```

**检查方法**：
1. 阅读 Contract 的 Must-not-change behaviors
2. 确认这些行为没有被改变

**不通过示例**：
- ❌ Contract 要求保持 API 接口不变，但修改了参数名称
- ❌ Contract 要求保持向后兼容，但删除了旧的配置项

#### ✅ Forbidden patterns 检查
```markdown
- [ ] 是否避免了 Contract 中禁止的模式？
- [ ] 是否没有使用全局变量（如 Contract 禁止）？
- [ ] 是否没有添加缓存（如 Contract 禁止）？
```

**检查方法**：
1. 阅读 Contract 的 Forbidden patterns
2. 搜索代码中是否存在这些模式

**不通过示例**：
- ❌ Contract 禁止全局变量，但代码中使用了 `global user_cache`
- ❌ Contract 禁止添加缓存，但代码中添加了 Redis 缓存

---

### 2.2 代码风格检查（Blocking）

#### ✅ 命名规范
```markdown
- [ ] 变量名是否使用了正确的命名风格？
  - Python: snake_case
  - Java: camelCase
  - JavaScript: camelCase
- [ ] 类名是否使用了 PascalCase？
- [ ] 常量是否使用了 UPPER_SNAKE_CASE？
- [ ] 函数名是否清晰描述了功能？
```

**检查方法**：
快速浏览代码，检查是否有明显的命名问题。

**不通过示例**：
- ❌ Python 中使用 `userName` 而不是 `user_name`
- ❌ 类名使用 `userService` 而不是 `UserService`
- ❌ 函数名使用 `func1()` 而不是 `calculate_total()`

#### ✅ 代码格式
```markdown
- [ ] 缩进是否一致（4 空格或 2 空格）？
- [ ] 是否有过长的行（> 100 字符）？
- [ ] 是否有多余的空行或缺少空行？
```

**检查方法**：
快速浏览代码，检查是否有明显的格式问题。

**不通过示例**：
- ❌ 混用 Tab 和空格缩进
- ❌ 单行代码超过 150 字符
- ❌ 函数之间没有空行分隔

#### ✅ 注释质量
```markdown
- [ ] 复杂逻辑是否有注释说明？
- [ ] 公共 API 是否有文档字符串？
- [ ] 是否避免了无用的注释？
```

**检查方法**：
检查关键函数和复杂逻辑是否有注释。

**不通过示例**：
- ❌ 复杂的算法没有任何注释
- ❌ 公共 API 函数没有 Docstring
- ❌ 注释内容是 `# 这是一个函数`（无用注释）

---

### 2.3 代码质量检查（Blocking）

#### ✅ 明显的逻辑错误
```markdown
- [ ] 是否有明显的逻辑错误？
- [ ] 是否有未处理的异常？
- [ ] 是否有空指针风险？
```

**检查方法**：
快速阅读核心逻辑，检查是否有明显问题。

**不通过示例**：
- ❌ `if user is None: return user.name`（空指针）
- ❌ `result = 10 / count`（除零风险）
- ❌ `file = open('data.txt')`（未关闭文件）

#### ✅ 代码重复
```markdown
- [ ] 是否有明显的代码重复？
- [ ] 是否可以提取公共函数？
```

**检查方法**：
快速浏览代码，检查是否有大段重复代码。

**不通过示例**：
- ❌ 同样的验证逻辑在 3 个地方重复
- ❌ 同样的数据库查询在多个函数中重复

#### ✅ 过度复杂
```markdown
- [ ] 函数是否过长（> 50 行）？
- [ ] 嵌套是否过深（> 3 层）？
- [ ] 是否有过度设计？
```

**检查方法**：
快速浏览代码，检查是否有明显的复杂度问题。

**不通过示例**：
- ❌ 单个函数超过 100 行
- ❌ 嵌套 5 层 if-else
- ❌ 为简单功能创建了复杂的抽象层

---

### 2.4 测试完整性检查（Blocking）

#### ✅ 测试文件存在
```markdown
- [ ] 是否为新增的功能添加了测试？
- [ ] 测试文件命名是否正确？
  - Python: test_*.py
  - Java: *Test.java
  - JavaScript: *.test.js
```

**检查方法**：
检查 `git diff` 输出，确认是否包含测试文件。

**不通过示例**：
- ❌ 添加了新功能但没有测试文件
- ❌ 测试文件命名为 `user_tests.py` 而不是 `test_user.py`

#### ✅ 测试覆盖关键路径
```markdown
- [ ] 是否测试了成功路径（Happy Path）？
- [ ] 是否测试了失败路径（Failure Path）？
- [ ] 是否测试了边界条件？
```

**检查方法**：
快速浏览测试代码，检查是否覆盖关键场景。

**不通过示例**：
- ❌ 只测试了成功情况，没有测试错误情况
- ❌ 没有测试边界条件（如空输入、最大值）

---

### 2.5 可观测性检查（Non-blocking）

#### ⚠️ 日志记录
```markdown
- [ ] 关键操作是否有日志记录？
- [ ] 错误是否有详细的错误信息？
```

**检查方法**：
快速浏览代码，检查是否有适当的日志。

**建议补充示例**：
- ⚠️ 数据库操作没有日志记录
- ⚠️ 异常捕获后没有记录错误信息

---

## 三、Claude 验收流程

### 3.1 快速验收流程（5-10 分钟）

```markdown
1. **查看改动文件**（1 分钟）
   - 运行 `git diff --name-only`
   - 确认改动文件是否在预期范围内

2. **Contract 符合性检查**（2 分钟）
   - 如果存在 Contract，检查 Scope、Must-not-change、Forbidden patterns
   - 如果不存在 Contract，跳过此步骤

3. **代码风格快速检查**（2 分钟）
   - 快速浏览代码，检查命名、格式、注释
   - 只关注明显的问题

4. **代码质量快速检查**（2 分钟）
   - 快速阅读核心逻辑，检查明显的逻辑错误
   - 检查是否有明显的代码重复或过度复杂

5. **测试完整性检查**（2 分钟）
   - 确认是否添加了测试文件
   - 快速浏览测试代码，检查是否覆盖关键场景

6. **给出验收结论**（1 分钟）
   - ✅ 通过：进入测试阶段
   - ❌ 不通过：列出问题，Claude 修复或重新委托 Coder
```

### 3.2 验收结论模板

**通过示例**：
```markdown
✅ Claude 验收通过

代码质量良好，符合基本标准：
- ✅ Scope 符合 Contract 要求
- ✅ 代码风格符合规范
- ✅ 无明显逻辑错误
- ✅ 测试覆盖关键场景

进入测试阶段。
```

**不通过示例**：
```markdown
❌ Claude 验收不通过

发现以下问题：
1. ❌ Scope 超出：修改了 Contract 之外的文件 `admin.py`
2. ❌ 命名不规范：变量 `userName` 应改为 `user_name`
3. ❌ 缺少测试：未添加失败路径测试

我将修复这些问题。
```

---

## 四、Claude 验收案例

### 案例 1：通过的代码

**改动文件**：
- `src/api/user.py`（修改）
- `tests/test_user.py`（新增）

**Contract 检查**：
- ✅ 只修改了 Contract 中列出的文件
- ✅ 保持了现有 API 接口不变
- ✅ 没有使用禁止的全局变量

**代码风格检查**：
- ✅ 命名规范：`user_name`, `UserService`, `MAX_RETRY`
- ✅ 代码格式：缩进一致，行长度合理
- ✅ 注释质量：关键函数有 Docstring

**代码质量检查**：
- ✅ 无明显逻辑错误
- ✅ 无明显代码重复
- ✅ 函数长度合理（< 30 行）

**测试完整性检查**：
- ✅ 添加了测试文件 `test_user.py`
- ✅ 测试覆盖成功和失败路径

**验收结论**：✅ 通过

---

### 案例 2：不通过的代码（Scope 超出）

**改动文件**：
- `src/api/user.py`（修改）
- `src/api/admin.py`（修改）← 不在 Contract 中
- `tests/test_user.py`（新增）

**Contract 检查**：
- ❌ 修改了 Contract 之外的文件 `admin.py`

**验收结论**：❌ 不通过
- 问题：Scope 超出，修改了 Contract 之外的文件
- 处理：回滚 `admin.py` 的修改

---

### 案例 3：不通过的代码（缺少测试）

**改动文件**：
- `src/api/user.py`（修改）

**测试完整性检查**：
- ❌ 未添加测试文件

**验收结论**：❌ 不通过
- 问题：缺少测试文件
- 处理：添加 `tests/test_user.py`

---

## 五、总结

### 5.1 核心要点

1. **Claude 验收是快速检查**：5-10 分钟，只关注明显问题
2. **Contract 符合性是第一优先级**：确保不超出 Scope
3. **代码风格和质量是基本要求**：避免明显的低级问题
4. **测试完整性是必需的**：确保添加了测试文件

### 5.2 快速参考

| 检查项 | 优先级 | 检查时间 |
|--------|--------|---------|
| Contract 符合性 | 🔴 Blocking | 2 分钟 |
| 代码风格 | 🔴 Blocking | 2 分钟 |
| 代码质量 | 🔴 Blocking | 2 分钟 |
| 测试完整性 | 🔴 Blocking | 2 分钟 |
| 可观测性 | 🟡 Non-blocking | 1 分钟 |

---

**文档版本**: v1.0
**最后更新**: 2026-01-17
**维护者**: CCG Team

# è‡ªåŠ¨åŒ–æ£€æŸ¥é›†æˆæŒ‡å—

> **ç›®æ ‡**ï¼šå®šä¹‰å¦‚ä½•åœ¨ CCG å·¥ä½œæµä¸­é›†æˆè‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·ï¼Œæé«˜ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚

---

## ä¸€ã€è‡ªåŠ¨åŒ–æ£€æŸ¥çš„ä»·å€¼

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼Ÿ

**è‡ªåŠ¨åŒ–æ£€æŸ¥çš„ä¼˜åŠ¿**ï¼š
- âœ… **å¿«é€Ÿåé¦ˆ**ï¼šç§’çº§å‘ç°é—®é¢˜ï¼Œè€Œä¸æ˜¯ç­‰å¾…äººå·¥å®¡æŸ¥
- âœ… **ä¸€è‡´æ€§**ï¼šæ ‡å‡†ç»Ÿä¸€ï¼Œä¸å—äººä¸ºå› ç´ å½±å“
- âœ… **èŠ‚çœæ—¶é—´**ï¼šè‡ªåŠ¨åŒ–å¤„ç†é‡å¤æ€§æ£€æŸ¥
- âœ… **æå‰å‘ç°é—®é¢˜**ï¼šåœ¨æäº¤å‰å‘ç°é—®é¢˜ï¼Œæˆæœ¬æœ€ä½

### 1.2 è‡ªåŠ¨åŒ–æ£€æŸ¥çš„ç±»å‹

| æ£€æŸ¥ç±»å‹ | å·¥å…·ç¤ºä¾‹ | æ£€æŸ¥å†…å®¹ | æ‰§è¡Œæ—¶æœº |
|---------|---------|---------|---------|
| **ä»£ç æ ¼å¼åŒ–** | Black, Prettier | ä»£ç æ ¼å¼ã€ç¼©è¿›ã€ç©ºè¡Œ | Coder æ‰§è¡Œå |
| **ä»£ç é£æ ¼æ£€æŸ¥** | Flake8, ESLint | å‘½åè§„èŒƒã€ä»£ç å¤æ‚åº¦ | Coder æ‰§è¡Œå |
| **ç±»å‹æ£€æŸ¥** | mypy, TypeScript | ç±»å‹é”™è¯¯ã€ç±»å‹ä¸åŒ¹é… | Coder æ‰§è¡Œå |
| **æµ‹è¯•è¿è¡Œ** | pytest, Jest | åŠŸèƒ½æ­£ç¡®æ€§ã€è¦†ç›–ç‡ | Claude éªŒæ”¶å |
| **å®‰å…¨æ‰«æ** | Bandit, npm audit | å®‰å…¨æ¼æ´ã€ä¾èµ–é£é™© | æµ‹è¯•é€šè¿‡å |

---

## äºŒã€é›†æˆç‚¹è®¾è®¡

### 2.1 åœ¨ CCG å·¥ä½œæµä¸­çš„é›†æˆç‚¹

```
Coder æ‰§è¡Œ
    â†“
ã€è‡ªåŠ¨åŒ–æ£€æŸ¥ 1ï¼šä»£ç æ ¼å¼åŒ–ã€‘â† è‡ªåŠ¨ä¿®å¤
    â†“
ã€è‡ªåŠ¨åŒ–æ£€æŸ¥ 2ï¼šä»£ç é£æ ¼æ£€æŸ¥ã€‘â† æŠ¥å‘Šé—®é¢˜
    â†“
ã€è‡ªåŠ¨åŒ–æ£€æŸ¥ 3ï¼šç±»å‹æ£€æŸ¥ã€‘â† æŠ¥å‘Šé—®é¢˜
    â†“
Claude éªŒæ”¶
    â†“
ã€è‡ªåŠ¨åŒ–æ£€æŸ¥ 4ï¼šæµ‹è¯•è¿è¡Œã€‘â† å¿…é¡»é€šè¿‡
    â†“
ã€è‡ªåŠ¨åŒ–æ£€æŸ¥ 5ï¼šè¦†ç›–ç‡æ£€æŸ¥ã€‘â† å¿…é¡»è¾¾æ ‡
    â†“
Codex å®¡æ ¸
    â†“
ã€è‡ªåŠ¨åŒ–æ£€æŸ¥ 6ï¼šå®‰å…¨æ‰«æã€‘â† æŠ¥å‘Šé£é™©
    â†“
Git æäº¤
```

### 2.2 é›†æˆç­–ç•¥

| é›†æˆç‚¹ | ç­–ç•¥ | å¤±è´¥å¤„ç† |
|--------|------|---------|
| **Coder æ‰§è¡Œå** | è‡ªåŠ¨è¿è¡Œæ ¼å¼åŒ–å’Œé£æ ¼æ£€æŸ¥ | è‡ªåŠ¨ä¿®å¤æˆ–æŠ¥å‘Šç»™ Claude |
| **Claude éªŒæ”¶å** | è‡ªåŠ¨è¿è¡Œæµ‹è¯•å’Œè¦†ç›–ç‡æ£€æŸ¥ | æµ‹è¯•å¤±è´¥åˆ™ Claude ä¿®å¤ |
| **Codex å®¡æ ¸å** | è‡ªåŠ¨è¿è¡Œå®‰å…¨æ‰«æ | æŠ¥å‘Šé£é™©ï¼Œç”± Claude å†³ç­– |

---

## ä¸‰ã€Python é¡¹ç›®è‡ªåŠ¨åŒ–æ£€æŸ¥

### 3.1 å·¥å…·é…ç½®

**å®‰è£…å·¥å…·**ï¼š
```bash
pip install black flake8 mypy pytest pytest-cov bandit
```

**é…ç½®æ–‡ä»¶**ï¼š

`pyproject.toml`:
```toml
[tool.black]
line-length = 100
target-version = ['py311']

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = "--cov=src --cov-report=term-missing --cov-fail-under=80"

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
```

`.flake8`:
```ini
[flake8]
max-line-length = 100
exclude = .git,__pycache__,venv
ignore = E203,W503
```

### 3.2 è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»º `scripts/auto_check.sh`:
```bash
#!/bin/bash
set -e

echo "ğŸ” å¼€å§‹è‡ªåŠ¨åŒ–æ£€æŸ¥..."

# 1. ä»£ç æ ¼å¼åŒ–
echo "ğŸ“ è¿è¡Œä»£ç æ ¼å¼åŒ–..."
black src/ tests/
echo "âœ… ä»£ç æ ¼å¼åŒ–å®Œæˆ"

# 2. ä»£ç é£æ ¼æ£€æŸ¥
echo "ğŸ¨ è¿è¡Œä»£ç é£æ ¼æ£€æŸ¥..."
flake8 src/ tests/
echo "âœ… ä»£ç é£æ ¼æ£€æŸ¥é€šè¿‡"

# 3. ç±»å‹æ£€æŸ¥
echo "ğŸ”¤ è¿è¡Œç±»å‹æ£€æŸ¥..."
mypy src/
echo "âœ… ç±»å‹æ£€æŸ¥é€šè¿‡"

# 4. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
pytest tests/ --cov=src --cov-report=term-missing
echo "âœ… æµ‹è¯•é€šè¿‡"

# 5. å®‰å…¨æ‰«æ
echo "ğŸ”’ è¿è¡Œå®‰å…¨æ‰«æ..."
bandit -r src/ -f json -o bandit-report.json || true
echo "âœ… å®‰å…¨æ‰«æå®Œæˆ"

echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"
```

### 3.3 é›†æˆåˆ° CCG å·¥ä½œæµ

**åœ¨ Coder æ‰§è¡Œåè‡ªåŠ¨è¿è¡Œ**ï¼š
```python
# ä¼ªä»£ç 
def after_coder_execution():
    # 1. è‡ªåŠ¨æ ¼å¼åŒ–
    run_command("black src/ tests/")

    # 2. æ£€æŸ¥ä»£ç é£æ ¼
    result = run_command("flake8 src/ tests/")
    if result.failed:
        report_to_claude(result.errors)

    # 3. æ£€æŸ¥ç±»å‹
    result = run_command("mypy src/")
    if result.failed:
        report_to_claude(result.errors)
```

---

## å››ã€Node.js é¡¹ç›®è‡ªåŠ¨åŒ–æ£€æŸ¥

### 4.1 å·¥å…·é…ç½®

**å®‰è£…å·¥å…·**ï¼š
```bash
npm install -D prettier eslint @typescript-eslint/parser jest @playwright/test
```

**é…ç½®æ–‡ä»¶**ï¼š

`.prettierrc`:
```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "printWidth": 100
}
```

`.eslintrc.json`:
```json
{
  "extends": ["eslint:recommended", "plugin:@typescript-eslint/recommended"],
  "parser": "@typescript-eslint/parser",
  "rules": {
    "no-console": "warn",
    "no-unused-vars": "error"
  }
}
```

`jest.config.js`:
```javascript
module.exports = {
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};
```

### 4.2 è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»º `scripts/auto-check.sh`:
```bash
#!/bin/bash
set -e

echo "ğŸ” å¼€å§‹è‡ªåŠ¨åŒ–æ£€æŸ¥..."

# 1. ä»£ç æ ¼å¼åŒ–
echo "ğŸ“ è¿è¡Œä»£ç æ ¼å¼åŒ–..."
npx prettier --write src/ tests/
echo "âœ… ä»£ç æ ¼å¼åŒ–å®Œæˆ"

# 2. ä»£ç é£æ ¼æ£€æŸ¥
echo "ğŸ¨ è¿è¡Œä»£ç é£æ ¼æ£€æŸ¥..."
npx eslint src/ tests/
echo "âœ… ä»£ç é£æ ¼æ£€æŸ¥é€šè¿‡"

# 3. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
npm test -- --coverage
echo "âœ… æµ‹è¯•é€šè¿‡"

# 4. å®‰å…¨æ‰«æ
echo "ğŸ”’ è¿è¡Œå®‰å…¨æ‰«æ..."
npm audit --json > audit-report.json || true
echo "âœ… å®‰å…¨æ‰«æå®Œæˆ"

echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"
```

---

## äº”ã€Java é¡¹ç›®è‡ªåŠ¨åŒ–æ£€æŸ¥

### 5.1 å·¥å…·é…ç½®

**Maven é…ç½®** (`pom.xml`):
```xml
<build>
  <plugins>
    <!-- Google Java Format -->
    <plugin>
      <groupId>com.spotify.fmt</groupId>
      <artifactId>fmt-maven-plugin</artifactId>
      <version>2.19</version>
      <executions>
        <execution>
          <goals>
            <goal>format</goal>
          </goals>
        </execution>
      </executions>
    </plugin>

    <!-- SpotBugs -->
    <plugin>
      <groupId>com.github.spotbugs</groupId>
      <artifactId>spotbugs-maven-plugin</artifactId>
      <version>4.7.3.0</version>
    </plugin>

    <!-- JaCoCo Coverage -->
    <plugin>
      <groupId>org.jacoco</groupId>
      <artifactId>jacoco-maven-plugin</artifactId>
      <version>0.8.10</version>
      <configuration>
        <rules>
          <rule>
            <element>BUNDLE</element>
            <limits>
              <limit>
                <counter>LINE</counter>
                <value>COVEREDRATIO</value>
                <minimum>0.80</minimum>
              </limit>
            </limits>
          </rule>
        </rules>
      </configuration>
    </plugin>
  </plugins>
</build>
```

### 5.2 è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»º `scripts/auto-check.sh`:
```bash
#!/bin/bash
set -e

echo "ğŸ” å¼€å§‹è‡ªåŠ¨åŒ–æ£€æŸ¥..."

# 1. ä»£ç æ ¼å¼åŒ–
echo "ğŸ“ è¿è¡Œä»£ç æ ¼å¼åŒ–..."
mvn fmt:format
echo "âœ… ä»£ç æ ¼å¼åŒ–å®Œæˆ"

# 2. ä»£ç é£æ ¼æ£€æŸ¥
echo "ğŸ¨ è¿è¡Œä»£ç é£æ ¼æ£€æŸ¥..."
mvn spotbugs:check
echo "âœ… ä»£ç é£æ ¼æ£€æŸ¥é€šè¿‡"

# 3. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
mvn test jacoco:report jacoco:check
echo "âœ… æµ‹è¯•é€šè¿‡"

echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"
```

---

## å…­ã€ç¯å¢ƒå‡†å¤‡å¼ºåˆ¶æ‰§è¡Œ

### 6.1 é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥

åˆ›å»º `scripts/verify_environment.py`:
```python
#!/usr/bin/env python3
"""ç¯å¢ƒéªŒè¯è„šæœ¬ - åœ¨é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ"""

import sys
import subprocess
from typing import List, Tuple

def check_command(cmd: str, min_version: str = None) -> Tuple[bool, str]:
    """æ£€æŸ¥å‘½ä»¤æ˜¯å¦å¯ç”¨"""
    try:
        result = subprocess.run(
            [cmd, "--version"],
            capture_output=True,
            text=True,
            timeout=5
        )
        version = result.stdout.strip() or result.stderr.strip()
        return True, version
    except (FileNotFoundError, subprocess.TimeoutExpired):
        return False, ""

def main():
    """ä¸»å‡½æ•°"""
    checks = [
        ("python", "Python 3.8+"),
        ("pip", "pip"),
        ("git", "Git"),
        ("pytest", "pytest"),
        ("black", "black"),
        ("flake8", "flake8"),
    ]

    print("ğŸ” ç¯å¢ƒæ£€æŸ¥å¼€å§‹...\n")

    failed = []
    for cmd, name in checks:
        success, version = check_command(cmd)
        if success:
            print(f"âœ… {name}: {version.split()[0]}")
        else:
            print(f"âŒ {name}: æœªå®‰è£…")
            failed.append(name)

    print("\n" + "="*50)
    if failed:
        print(f"âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œç¼ºå°‘ä»¥ä¸‹å·¥å…·ï¼š{', '.join(failed)}")
        print("\nè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š")
        print(f"pip install {' '.join(failed)}")
        sys.exit(1)
    else:
        print("âœ… ç¯å¢ƒæ£€æŸ¥é€šè¿‡ï¼")
        sys.exit(0)

if __name__ == "__main__":
    main()
```

### 6.2 åœ¨ CCG å·¥ä½œæµä¸­å¼ºåˆ¶æ‰§è¡Œ

**åœ¨é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ**ï¼š
```python
# ä¼ªä»£ç 
def ccg_workflow_start():
    # ç¬¬ä¸€æ­¥ï¼šå¼ºåˆ¶ç¯å¢ƒæ£€æŸ¥
    result = run_command("python scripts/verify_environment.py")

    if result.failed:
        return {
            "status": "ç¯å¢ƒæ£€æŸ¥å¤±è´¥",
            "missing": result.missing_tools,
            "install_command": result.install_command
        }

    # ç¬¬äºŒæ­¥ï¼šç»§ç»­æ­£å¸¸æµç¨‹
    # ...
```

---

## ä¸ƒã€æ€»ç»“

### 7.1 æ ¸å¿ƒè¦ç‚¹

1. **è‡ªåŠ¨åŒ–æ£€æŸ¥æé«˜æ•ˆç‡**ï¼šå¿«é€Ÿåé¦ˆï¼Œä¸€è‡´æ€§æ ‡å‡†
2. **å¤šä¸ªé›†æˆç‚¹**ï¼šCoder æ‰§è¡Œåã€Claude éªŒæ”¶åã€Codex å®¡æ ¸å
3. **è¯­è¨€ç‰¹å®šå·¥å…·**ï¼šPython (Black, Flake8), Node.js (Prettier, ESLint), Java (Google Java Format, SpotBugs)
4. **ç¯å¢ƒå‡†å¤‡å¼ºåˆ¶æ‰§è¡Œ**ï¼šé¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ

### 7.2 å¿«é€Ÿå‚è€ƒ

| æ£€æŸ¥ç±»å‹ | Python | Node.js | Java |
|---------|--------|---------|------|
| æ ¼å¼åŒ– | Black | Prettier | Google Java Format |
| é£æ ¼æ£€æŸ¥ | Flake8 | ESLint | SpotBugs |
| ç±»å‹æ£€æŸ¥ | mypy | TypeScript | - |
| æµ‹è¯• | pytest | Jest | JUnit |
| è¦†ç›–ç‡ | pytest-cov | Jest | JaCoCo |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-17
**ç»´æŠ¤è€…**: CCG Team

# CCG å†³ç­–å†²çªè§£å†³æœºåˆ¶

> **ç”¨é€”**ï¼šå½“å¤šä¸ªå†³ç­–è§„åˆ™å†²çªæ—¶ï¼Œæä¾›æ˜ç¡®çš„ä¼˜å…ˆçº§å’Œè§£å†³æ–¹æ¡ˆ

## æ¦‚è¿°

åœ¨ CCG ç³»ç»Ÿä¸­ï¼Œå¯èƒ½å‡ºç°å¤šä¸ªå†³ç­–è§„åˆ™åŒæ—¶é€‚ç”¨ä½†ç»“è®ºç›¸äº’å†²çªçš„æƒ…å†µã€‚æœ¬æ–‡æ¡£å®šä¹‰äº†å†³ç­–ä¼˜å…ˆçº§ä½“ç³»å’Œå†²çªè§£å†³è§„åˆ™ã€‚

---

## å†³ç­–ä¼˜å…ˆçº§ä½“ç³»

### æ ¸å¿ƒä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰

```
1. å®‰å…¨æ€§ (Safety)
2. ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤ (User Explicit Command)
3. Contract çº¦æŸ (Contract Constraints)
4. è¶…æ—¶ä¿æŠ¤ (Timeout Protection)
5. æ•ˆç‡ä¼˜åŒ– (Efficiency)
```

### ä¼˜å…ˆçº§è¯¦è§£

#### ä¼˜å…ˆçº§ 1ï¼šå®‰å…¨æ€§ï¼ˆæœ€é«˜ï¼‰

**å®šä¹‰**ï¼šæ¶‰åŠæ•°æ®å®‰å…¨ã€ç³»ç»Ÿç¨³å®šã€ä¸å¯é€†æ“ä½œçš„å†³ç­–

**è§„åˆ™**ï¼š
- ä»»ä½•å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±çš„æ“ä½œå¿…é¡»è¯¢é—®ç”¨æˆ·
- ä»»ä½•å¯èƒ½ç ´åç³»ç»Ÿç¨³å®šçš„æ“ä½œå¿…é¡»åœæ­¢
- å®‰å…¨æ€§ä¼˜å…ˆäºæ•ˆç‡å’Œç”¨æˆ·ä¾¿åˆ©

**ç¤ºä¾‹**ï¼š
```
å†²çªåœºæ™¯ï¼š
- Contract å…è®¸åˆ é™¤æ–‡ä»¶
- ä½†æ–‡ä»¶åŒ…å«é‡è¦æ•°æ®ä¸”æ— å¤‡ä»½

è§£å†³æ–¹æ¡ˆï¼š
â†’ å®‰å…¨æ€§ä¼˜å…ˆï¼Œå¿…é¡»è¯¢é—®ç”¨æˆ·å¹¶å»ºè®®å¤‡ä»½
```

#### ä¼˜å…ˆçº§ 2ï¼šç”¨æˆ·æ˜ç¡®æŒ‡ä»¤

**å®šä¹‰**ï¼šç”¨æˆ·åœ¨å½“å‰ä¼šè¯ä¸­æ˜ç¡®è¡¨è¾¾çš„æ„å›¾

**è§„åˆ™**ï¼š
- ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤è¦†ç›–é»˜è®¤é…ç½®
- ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤è¦†ç›– Contractï¼ˆä½†éœ€è¦è­¦å‘Šï¼‰
- ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤ä¸èƒ½è¦†ç›–å®‰å…¨æ€§è§„åˆ™

**ç¤ºä¾‹**ï¼š
```
å†²çªåœºæ™¯ï¼š
- é…ç½®æ–‡ä»¶è®¾ç½® auto_fix_syntax = level_2ï¼ˆéœ€è¦ç¡®è®¤ï¼‰
- ç”¨æˆ·è¯´ï¼š"ç›´æ¥ä¿®å¤æ‰€æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸è¦é—®æˆ‘"

è§£å†³æ–¹æ¡ˆï¼š
â†’ ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤ä¼˜å…ˆï¼Œä¸´æ—¶è°ƒæ•´ä¸º level_1
â†’ è®°å½•åˆ°ä¼šè¯çŠ¶æ€ï¼Œä»…æœ¬æ¬¡ä¼šè¯æœ‰æ•ˆ
```

#### ä¼˜å…ˆçº§ 3ï¼šContract çº¦æŸ

**å®šä¹‰**ï¼šé¡¹ç›® Contract ä¸­å®šä¹‰çš„è§„åˆ™å’Œçº¦æŸ

**è§„åˆ™**ï¼š
- Contract å®šä¹‰çš„ Must-not-change å¿…é¡»éµå®ˆ
- Contract å®šä¹‰çš„ Scope ä¸èƒ½è¶…å‡º
- Contract å¯ä»¥è¢«ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤è¦†ç›–ï¼ˆä½†éœ€è¦è­¦å‘Šï¼‰

**ç¤ºä¾‹**ï¼š
```
å†²çªåœºæ™¯ï¼š
- Contract è§„å®š Must-not-change: æ•°æ®åº“æ¨¡å‹
- Coder ä¿®å¤ Bug æ—¶éœ€è¦ä¿®æ”¹æ•°æ®åº“æ¨¡å‹

è§£å†³æ–¹æ¡ˆï¼š
â†’ Contract çº¦æŸä¼˜å…ˆï¼Œåœæ­¢ä¿®å¤
â†’ è¯¢é—®ç”¨æˆ·ï¼šæ˜¯å¦ä¿®æ”¹ Contract æˆ–é‡‡ç”¨å…¶ä»–æ–¹æ¡ˆ
```

#### ä¼˜å…ˆçº§ 4ï¼šè¶…æ—¶ä¿æŠ¤

**å®šä¹‰**ï¼šé˜²æ­¢ä»»åŠ¡å¡æ­»ã€èµ„æºè€—å°½çš„ä¿æŠ¤æœºåˆ¶

**è§„åˆ™**ï¼š
- è¶…æ—¶ä¿æŠ¤ä¼˜å…ˆäºæ•ˆç‡ä¼˜åŒ–
- è¶…æ—¶ä¿æŠ¤å¯ä»¥è¢«ç”¨æˆ·æ˜ç¡®å»¶é•¿
- è¶…æ—¶ä¿æŠ¤ä¸èƒ½è¦†ç›–å®‰å…¨æ€§è§„åˆ™

**ç¤ºä¾‹**ï¼š
```
å†²çªåœºæ™¯ï¼š
- Coder ä»»åŠ¡æ‰§è¡Œè¶…è¿‡ 10 åˆ†é’Ÿï¼ˆæœ€å¤§è¶…æ—¶ï¼‰
- ä»»åŠ¡å³å°†å®Œæˆï¼ˆè¿˜éœ€ 30 ç§’ï¼‰

è§£å†³æ–¹æ¡ˆï¼š
â†’ è¶…æ—¶ä¿æŠ¤ä¼˜å…ˆï¼Œå¼ºåˆ¶ç»ˆæ­¢ä»»åŠ¡
â†’ å‘ç”¨æˆ·æŠ¥å‘Šæƒ…å†µï¼Œè¯¢é—®æ˜¯å¦é‡è¯•æˆ–å»¶é•¿è¶…æ—¶
```

#### ä¼˜å…ˆçº§ 5ï¼šæ•ˆç‡ä¼˜åŒ–ï¼ˆæœ€ä½ï¼‰

**å®šä¹‰**ï¼šæå‡æ‰§è¡Œæ•ˆç‡ã€å‡å°‘ç­‰å¾…æ—¶é—´çš„ä¼˜åŒ–

**è§„åˆ™**ï¼š
- æ•ˆç‡ä¼˜åŒ–ä¸èƒ½ç‰ºç‰²å®‰å…¨æ€§
- æ•ˆç‡ä¼˜åŒ–ä¸èƒ½è¿å Contract
- æ•ˆç‡ä¼˜åŒ–å¯ä»¥è¢«ç”¨æˆ·é…ç½®è°ƒæ•´

**ç¤ºä¾‹**ï¼š
```
å†²çªåœºæ™¯ï¼š
- æ‰¹é‡ä¿®å¤å¯ä»¥æå‡æ•ˆç‡
- ä½†ç”¨æˆ·é…ç½®è¦æ±‚é€ä¸ªç¡®è®¤

è§£å†³æ–¹æ¡ˆï¼š
â†’ ç”¨æˆ·é…ç½®ä¼˜å…ˆï¼Œé€ä¸ªç¡®è®¤
â†’ å¯ä»¥å»ºè®®ç”¨æˆ·è°ƒæ•´é…ç½®ä»¥æå‡æ•ˆç‡
```

---

## å¸¸è§å†²çªåœºæ™¯å’Œè§£å†³æ–¹æ¡ˆ

### å†²çª 1ï¼šContract vs è¶…æ—¶

**åœºæ™¯**ï¼š
```
- Contract è¦æ±‚å®Œæˆæ‰€æœ‰åŠŸèƒ½
- ä½† Coder æ‰§è¡Œè¶…è¿‡æœ€å¤§è¶…æ—¶ï¼ˆ10 åˆ†é’Ÿï¼‰
```

**å†²çªåˆ†æ**ï¼š
- Contract è¦æ±‚å®Œæˆä»»åŠ¡ï¼ˆä¼˜å…ˆçº§ 3ï¼‰
- è¶…æ—¶ä¿æŠ¤è¦æ±‚ç»ˆæ­¢ä»»åŠ¡ï¼ˆä¼˜å…ˆçº§ 4ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
è¶…æ—¶ä¿æŠ¤ä¼˜å…ˆçº§ > Contract
â†’ å¼ºåˆ¶ç»ˆæ­¢ä»»åŠ¡
â†’ å‘ç”¨æˆ·æŠ¥å‘Šï¼š
  "ä»»åŠ¡æ‰§è¡Œè¶…æ—¶ï¼ˆ10 åˆ†é’Ÿï¼‰ï¼Œå·²å¼ºåˆ¶ç»ˆæ­¢ã€‚
   Contract è¦æ±‚å®Œæˆæ‰€æœ‰åŠŸèƒ½ï¼Œä½†ä»»åŠ¡è¿‡äºå¤æ‚ã€‚
   
   å»ºè®®æ–¹æ¡ˆï¼š
   1. æ‹†åˆ†ä»»åŠ¡ä¸ºå¤šä¸ªå°ä»»åŠ¡
   2. å»¶é•¿è¶…æ—¶é™åˆ¶ï¼ˆéœ€è¦æ‚¨æ˜ç¡®æˆæƒï¼‰
   3. ç®€åŒ– Contract èŒƒå›´
   
   è¯·é€‰æ‹©ï¼š"
```

### å†²çª 2ï¼šç”¨æˆ·æŒ‡ä»¤ vs Contract

**åœºæ™¯**ï¼š
```
- Contract è§„å®š Must-not-change: è®¤è¯é€»è¾‘
- ç”¨æˆ·è¯´ï¼š"ä¿®æ”¹è®¤è¯é€»è¾‘ï¼Œæ·»åŠ  OAuth æ”¯æŒ"
```

**å†²çªåˆ†æ**ï¼š
- ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤ï¼ˆä¼˜å…ˆçº§ 2ï¼‰
- Contract çº¦æŸï¼ˆä¼˜å…ˆçº§ 3ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤ä¼˜å…ˆçº§ > Contract
â†’ æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ï¼Œä½†éœ€è¦è­¦å‘Š
â†’ å‘ç”¨æˆ·æŠ¥å‘Šï¼š
  "âš ï¸ æ³¨æ„ï¼šæ‚¨çš„æŒ‡ä»¤ä¸ Contract å†²çª
   
   Contract è§„å®šï¼šMust-not-change: è®¤è¯é€»è¾‘
   æ‚¨çš„æŒ‡ä»¤ï¼šä¿®æ”¹è®¤è¯é€»è¾‘ï¼Œæ·»åŠ  OAuth æ”¯æŒ
   
   æˆ‘å°†æ‰§è¡Œæ‚¨çš„æŒ‡ä»¤ï¼Œä½†å»ºè®®ï¼š
   1. æ›´æ–° Contractï¼Œç§»é™¤ Must-not-change é™åˆ¶
   2. æˆ–è€…åˆ›å»ºæ–°çš„ Contract ç”¨äº OAuth åŠŸèƒ½
   
   æ˜¯å¦ç»§ç»­æ‰§è¡Œï¼Ÿ"
```

### å†²çª 3ï¼šå®‰å…¨æ€§ vs æ•ˆç‡

**åœºæ™¯**ï¼š
```
- æ‰¹é‡åˆ é™¤ 10 ä¸ªæ–‡ä»¶å¯ä»¥æå‡æ•ˆç‡
- ä½†åˆ é™¤æ“ä½œä¸å¯é€†ï¼Œå­˜åœ¨å®‰å…¨é£é™©
```

**å†²çªåˆ†æ**ï¼š
- å®‰å…¨æ€§è¦æ±‚é€ä¸ªç¡®è®¤ï¼ˆä¼˜å…ˆçº§ 1ï¼‰
- æ•ˆç‡ä¼˜åŒ–å»ºè®®æ‰¹é‡å¤„ç†ï¼ˆä¼˜å…ˆçº§ 5ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
å®‰å…¨æ€§ä¼˜å…ˆçº§ > æ•ˆç‡
â†’ ä¸æä¾›æ‰¹é‡åˆ é™¤é€‰é¡¹
â†’ é€ä¸ªç¡®è®¤æ¯ä¸ªåˆ é™¤æ“ä½œ
â†’ å‘ç”¨æˆ·è¯´æ˜ï¼š
  "æ£€æµ‹åˆ° 10 ä¸ªæ–‡ä»¶éœ€è¦åˆ é™¤ã€‚
   
   ç”±äºåˆ é™¤æ“ä½œä¸å¯é€†ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œ
   æˆ‘å°†é€ä¸ªå‘æ‚¨ç¡®è®¤æ¯ä¸ªæ–‡ä»¶çš„åˆ é™¤ã€‚
   
   æ–‡ä»¶ 1/10: src/old_auth.py
   æ˜¯å¦åˆ é™¤ï¼Ÿ[æ˜¯/å¦/æŸ¥çœ‹å†…å®¹]"
```

### å†²çª 4ï¼šå†³ç­–ç­‰çº§ vs ç”¨æˆ·é…ç½®

**åœºæ™¯**ï¼š
```
- decision_authority_matrix.md è§„å®šè¯­æ³•é”™è¯¯ä¿®å¤ä¸º Level 2ï¼ˆéœ€è¦ç¡®è®¤ï¼‰
- ç”¨æˆ·é…ç½® auto_fix_syntax = level_1ï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰
```

**å†²çªåˆ†æ**ï¼š
- é»˜è®¤è§„åˆ™ï¼ˆLevel 2ï¼‰
- ç”¨æˆ·é…ç½®ï¼ˆLevel 1ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
ç”¨æˆ·é…ç½®ä¼˜å…ˆçº§ > é»˜è®¤è§„åˆ™
â†’ ä½¿ç”¨ Level 1ï¼ˆè‡ªåŠ¨ä¿®å¤ä½†æŠ¥å‘Šï¼‰
â†’ é¦–æ¬¡ä½¿ç”¨æ—¶æç¤ºç”¨æˆ·ï¼š
  "ğŸ”µ æ£€æµ‹åˆ°æ‚¨çš„é…ç½®ï¼šauto_fix_syntax = level_1
   
   æˆ‘å°†è‡ªåŠ¨ä¿®å¤è¯­æ³•é”™è¯¯å¹¶æŠ¥å‘Šç»“æœã€‚
   å¦‚æœæ‚¨å¸Œæœ›æ¯æ¬¡éƒ½ç¡®è®¤ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®ä¸º level_2ã€‚
   
   æ­£åœ¨è‡ªåŠ¨ä¿®å¤..."
```

---

## å†²çªè§£å†³å†³ç­–æ ‘

```
æ£€æµ‹åˆ°å†³ç­–å†²çª
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¯å¦æ¶‰åŠå®‰å…¨æ€§ï¼Ÿ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ æ˜¯              â†“ å¦
å®‰å…¨æ€§ä¼˜å…ˆ        ç»§ç»­åˆ¤æ–­
    â†“                  â†“
æ‰§è¡Œå®‰å…¨ç­–ç•¥    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ æ˜¯å¦æœ‰ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤ï¼Ÿâ”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ æ˜¯        â†“ å¦
                ç”¨æˆ·æŒ‡ä»¤ä¼˜å…ˆ  ç»§ç»­åˆ¤æ–­
                    â†“              â†“
                æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ Contractçº¦æŸï¼Ÿâ”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“ æ˜¯    â†“ å¦
                              Contractä¼˜å…ˆ ç»§ç»­åˆ¤æ–­
                                  â†“          â†“
                              éµå®ˆContract â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚ è¶…æ—¶ä¿æŠ¤ï¼Ÿâ”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“ æ˜¯  â†“ å¦
                                          è¶…æ—¶ä¼˜å…ˆ æ•ˆç‡ä¼˜å…ˆ
```

---

## å†²çªè§£å†³å®æ–½æŒ‡å—

### Claude æ£€æµ‹å†²çªçš„æµç¨‹

```python
def detect_conflict(decision_context):
    """æ£€æµ‹å†³ç­–å†²çª"""
    conflicts = []
    
    # æ£€æŸ¥å®‰å…¨æ€§å†²çª
    if decision_context.has_safety_risk():
        conflicts.append({
            "type": "safety",
            "priority": 1,
            "rule": "å®‰å…¨æ€§ä¼˜å…ˆ"
        })
    
    # æ£€æŸ¥ç”¨æˆ·æŒ‡ä»¤å†²çª
    if decision_context.has_user_command():
        conflicts.append({
            "type": "user_command",
            "priority": 2,
            "rule": "ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤"
        })
    
    # æ£€æŸ¥ Contract å†²çª
    if decision_context.violates_contract():
        conflicts.append({
            "type": "contract",
            "priority": 3,
            "rule": "Contract çº¦æŸ"
        })
    
    # æ£€æŸ¥è¶…æ—¶å†²çª
    if decision_context.exceeds_timeout():
        conflicts.append({
            "type": "timeout",
            "priority": 4,
            "rule": "è¶…æ—¶ä¿æŠ¤"
        })
    
    return conflicts

def resolve_conflict(conflicts):
    """è§£å†³å†²çªï¼Œé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„è§„åˆ™"""
    if not conflicts:
        return None
    
    # æŒ‰ä¼˜å…ˆçº§æ’åº
    conflicts.sort(key=lambda x: x["priority"])
    
    # è¿”å›ä¼˜å…ˆçº§æœ€é«˜çš„è§„åˆ™
    return conflicts[0]
```

### å†²çªæŠ¥å‘Šæ¨¡æ¿

```
âš ï¸ æ£€æµ‹åˆ°å†³ç­–å†²çª

**å†²çªè§„åˆ™**ï¼š
1. [è§„åˆ™1]ï¼ˆä¼˜å…ˆçº§ [N]ï¼‰
2. [è§„åˆ™2]ï¼ˆä¼˜å…ˆçº§ [M]ï¼‰

**å†²çªåˆ†æ**ï¼š
[è¯¦ç»†è¯´æ˜å†²çªçš„åŸå› å’Œå½±å“]

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ ¹æ®å†³ç­–ä¼˜å…ˆçº§ä½“ç³»ï¼Œ[è§„åˆ™1] ä¼˜å…ˆçº§æ›´é«˜ã€‚

**æ‰§è¡Œå†³ç­–**ï¼š
[å…·ä½“çš„æ‰§è¡Œæ–¹æ¡ˆ]

**å»ºè®®**ï¼š
[ç»™ç”¨æˆ·çš„å»ºè®®ï¼Œå¦‚ä½•é¿å…æœªæ¥çš„å†²çª]
```


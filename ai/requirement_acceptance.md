# 需求验收标准

> **目标**：定义需求文档的验收标准，确保需求质量达标后才进入开发阶段。

---

## 一、为什么需要需求验收？

### 1.1 需求质量的重要性

**需求质量直接影响**：
- 📊 **开发效率**：清晰的需求 → 准确的拆解 → 快速的实现
- 💰 **开发成本**：模糊的需求 → 频繁返工 → 成本增加
- ✅ **交付质量**：完整的需求 → 全面的测试 → 高质量交付
- 🎯 **用户满意度**：准确的需求 → 符合预期 → 用户满意

### 1.2 需求验收的价值

**通过需求验收可以**：
- ✅ 在开发前发现需求问题（成本最低）
- ✅ 避免需求理解偏差导致的返工
- ✅ 确保所有必要信息都已提供
- ✅ 建立清晰的验收标准

---

## 二、需求验收检查清单

### 2.1 必需要素检查（Blocking）

**以下要素缺一不可，否则需求不通过**：

| 检查项 | 说明 | 示例 |
|--------|------|------|
| ✅ **功能描述** | 清晰描述要实现的功能 | "实现基于 JWT 的用户登录功能" |
| ✅ **使用场景** | 说明在什么情况下使用 | "用户访问系统时需要登录获取 token" |
| ✅ **输入说明** | 列出所有输入项及其约束 | "邮箱（必需）、密码（8-32 位）" |
| ✅ **输出说明** | 列出所有输出项及其格式 | "返回 JWT token 和用户信息" |
| ✅ **验收标准** | 提供可验证的标准 | "正确的邮箱密码能够登录成功" |

**检查方法**：
```markdown
- [ ] 功能描述：是否用 1-3 句话清晰描述了功能？
- [ ] 使用场景：是否说明了在什么情况下使用？
- [ ] 输入说明：是否列出了所有输入项及其类型、格式、约束？
- [ ] 输出说明：是否列出了所有输出项及其类型、格式？
- [ ] 验收标准：是否提供了至少 3 条可验证的标准？
```

### 2.2 质量标准检查（Blocking）

**以下标准必须满足，否则需求不通过**：

| 检查项 | 说明 | 好的示例 | 不好的示例 |
|--------|------|---------|-----------|
| ✅ **清晰性** | 使用简单直白的语言 | "用户输入邮箱和密码" | "用户进行身份验证操作" |
| ✅ **完整性** | 包含所有必要信息 | 列出所有输入输出和边界条件 | 只说"实现登录功能" |
| ✅ **可验证性** | 所有要求都可验证 | "响应时间 < 200ms" | "性能要快" |
| ✅ **无歧义性** | 不使用模糊词汇 | "密码长度 8-32 位" | "密码不能太短" |

**检查方法**：
```markdown
- [ ] 清晰性：是否避免了模糊词汇（可能、大概、差不多）？
- [ ] 完整性：是否包含了所有必要的输入输出和边界条件？
- [ ] 可验证性：是否所有要求都是可测试、可验证的？
- [ ] 无歧义性：是否每个要求都有明确的含义？
```

### 2.3 推荐要素检查（Non-blocking）

**以下要素推荐提供，但不强制**：

| 检查项 | 说明 | 何时需要 |
|--------|------|---------|
| ⚠️ **技术约束** | 使用的技术栈 | 有特定技术要求时 |
| ⚠️ **性能要求** | 响应时间、并发量 | 性能敏感的功能 |
| ⚠️ **边界条件** | 异常情况处理 | 复杂的业务逻辑 |
| ⚠️ **UI/UX 要求** | 界面设计要求 | 前端功能 |

---

## 三、需求验收流程

### 3.1 自动化检查（第一关）

**使用需求验收脚本自动检查**：

```python
# scripts/verify_requirement.py
def check_requirement(requirement_text):
    """检查需求文档是否包含必需要素"""
    checks = {
        "功能描述": "## 1. 功能描述" in requirement_text or "功能描述" in requirement_text,
        "使用场景": "## 2. 使用场景" in requirement_text or "使用场景" in requirement_text,
        "输入输出": ("输入" in requirement_text and "输出" in requirement_text),
        "验收标准": "验收标准" in requirement_text or "acceptance criteria" in requirement_text.lower(),
    }

    missing = [k for k, v in checks.items() if not v]

    if missing:
        print(f"❌ 需求文档缺少以下要素：{', '.join(missing)}")
        return False
    else:
        print("✅ 需求文档包含所有必需要素")
        return True
```

### 3.2 Claude 人工审查（第二关）

**Claude 使用检查清单审查需求**：

```markdown
## 需求验收检查清单

### 必需要素（Blocking）
- [ ] 功能描述：清晰描述要实现的功能
- [ ] 使用场景：说明在什么情况下使用
- [ ] 输入说明：列出所有输入项及其约束
- [ ] 输出说明：列出所有输出项及其格式
- [ ] 验收标准：提供至少 3 条可验证的标准

### 质量标准（Blocking）
- [ ] 清晰性：使用简单直白的语言，避免模糊词汇
- [ ] 完整性：包含所有必要信息
- [ ] 可验证性：所有要求都可测试、可验证
- [ ] 无歧义性：每个要求都有明确的含义

### 推荐要素（Non-blocking）
- [ ] 技术约束：说明使用的技术栈（如有特定要求）
- [ ] 性能要求：说明响应时间、并发量（如性能敏感）
- [ ] 边界条件：说明异常情况处理（如复杂逻辑）
- [ ] UI/UX 要求：说明界面设计要求（如前端功能）

### 审查结论
- [ ] ✅ 通过：需求质量良好，可以进入开发
- [ ] ⚠️ 需要补充：[列出需要补充的内容]
- [ ] ❌ 不通过：[列出具体问题]
```

### 3.3 用户确认（第三关）

**Claude 向用户反馈审查结果**：

**通过示例**：
```markdown
✅ 需求验收通过

您的需求文档质量良好，包含所有必需要素：
- ✅ 功能描述清晰
- ✅ 使用场景明确
- ✅ 输入输出完整
- ✅ 验收标准可验证

我将开始创建 Implementation Contract 并进入开发阶段。
```

**需要补充示例**：
```markdown
⚠️ 需求需要补充

您的需求文档基本完整，但建议补充以下内容：
- ⚠️ 性能要求：建议说明响应时间要求（如 < 200ms）
- ⚠️ 边界条件：建议说明异常情况处理（如邮箱格式错误时返回什么）

是否补充这些内容？如果不需要，我将使用默认假设继续。
```

**不通过示例**：
```markdown
❌ 需求验收不通过

您的需求文档缺少以下必需要素：
- ❌ 输入说明：未列出所有输入项及其约束
- ❌ 验收标准：未提供可验证的标准

请补充这些内容后重新提交。
```

---

## 四、需求验收案例

### 案例 1：通过的需求

```markdown
# 用户登录功能

## 1. 功能描述
实现基于 JWT 的用户登录功能，用户输入邮箱和密码，系统验证后返回 JWT token。

## 2. 使用场景
已注册用户访问系统时，需要登录获取 token 用于后续 API 调用。

## 3. 输入输出

### 输入
- 邮箱：字符串，必须符合邮箱格式
- 密码：字符串，长度 8-32 位

### 输出
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "user_id": "uuid",
      "email": "user@example.com"
    }
  }
}
```

## 4. 验收标准
- [ ] 正确的邮箱密码返回 token
- [ ] 错误的密码返回 401 错误
- [ ] 不存在的邮箱返回 404 错误
- [ ] JWT token 有效期为 7 天
```

**验收结果**：✅ 通过
- ✅ 功能描述清晰
- ✅ 使用场景明确
- ✅ 输入输出完整
- ✅ 验收标准可验证（4 条）

---

### 案例 2：需要补充的需求

```markdown
# 用户登录功能

## 功能描述
实现用户登录功能。

## 输入输出
- 输入：邮箱、密码
- 输出：登录凭证

## 验收标准
- 能够登录成功
```

**验收结果**：⚠️ 需要补充
- ⚠️ 使用场景：未说明在什么情况下使用
- ⚠️ 输入约束：未说明邮箱和密码的格式要求
- ⚠️ 输出格式：未说明"登录凭证"的具体格式
- ⚠️ 验收标准：过于模糊，需要更具体的标准

**建议补充**：
1. 添加使用场景说明
2. 明确输入约束（邮箱格式、密码长度）
3. 明确输出格式（JSON 结构）
4. 细化验收标准（正确/错误情况的具体行为）

---

### 案例 3：不通过的需求

```markdown
# 实现一个用户系统

需要实现用户注册、登录、个人信息管理等功能。
```

**验收结果**：❌ 不通过
- ❌ 功能描述：过于宽泛，需要拆分为多个独立需求
- ❌ 使用场景：缺失
- ❌ 输入输出：缺失
- ❌ 验收标准：缺失

**建议**：
将"用户系统"拆分为多个独立需求：
1. 用户注册功能
2. 用户登录功能
3. 个人信息管理功能

每个需求单独编写文档，包含完整的输入输出和验收标准。

---

## 五、需求验收的常见问题

### Q1: 需求验收会不会太严格，影响开发效率？

**答**：恰恰相反，需求验收能够提高开发效率。

**数据支持**：
- 在需求阶段发现问题的成本：1x
- 在开发阶段发现问题的成本：10x
- 在测试阶段发现问题的成本：100x
- 在生产阶段发现问题的成本：1000x

**结论**：需求验收是成本最低的质量保障手段。

### Q2: 我不知道技术细节，能通过需求验收吗？

**答**：可以！需求验收不要求技术细节。

**必需的**：
- 功能描述（做什么）
- 使用场景（什么时候用）
- 输入输出（输入什么，输出什么）
- 验收标准（如何判断完成）

**可选的**：
- 技术约束（用什么技术）
- 性能要求（多快）
- 实现细节（怎么做）

### Q3: 需求验收失败后怎么办？

**答**：根据反馈补充需求文档。

**流程**：
1. Claude 指出缺失的要素或问题
2. 用户补充相应内容
3. 重新提交需求验收
4. 通过后进入开发阶段

---

## 六、需求验收与 CCG 工作流集成

### 6.1 集成点

```
用户提交需求
    ↓
【需求验收】← 第一个质量门禁
    ↓
通过 → 创建 Contract → 开发
不通过 → 补充需求 → 重新验收
```

### 6.2 Claude 的职责

**在需求验收阶段，Claude 需要**：
1. 使用检查清单审查需求文档
2. 给出明确的验收结论（通过/需要补充/不通过）
3. 如不通过，清晰列出缺失的要素或问题
4. 如需要补充，给出具体的补充建议
5. 通过后，进入需求拆解阶段

### 6.3 自动化集成

**在 CCG 工作流中自动执行需求验收**：

```python
# 伪代码
def ccg_workflow(user_requirement):
    # 第一步：需求验收
    acceptance_result = verify_requirement(user_requirement)

    if not acceptance_result.passed:
        return {
            "status": "需求验收失败",
            "missing": acceptance_result.missing,
            "suggestions": acceptance_result.suggestions
        }

    # 第二步：创建 Contract
    contract = create_contract(user_requirement)

    # 第三步：Coder 执行
    # ...
```

---

## 七、总结

### 7.1 核心要点

1. **需求验收是第一个质量门禁**：在开发前发现问题
2. **必需要素不可缺**：功能描述、使用场景、输入输出、验收标准
3. **质量标准必须满足**：清晰、完整、可验证、无歧义
4. **三关验收**：自动化检查 → Claude 审查 → 用户确认

### 7.2 快速参考

| 验收结果 | 说明 | 下一步 |
|---------|------|--------|
| ✅ 通过 | 需求质量良好 | 进入开发阶段 |
| ⚠️ 需要补充 | 基本完整，建议补充 | 用户决定是否补充 |
| ❌ 不通过 | 缺少必需要素 | 补充后重新验收 |

---

**文档版本**: v1.0
**最后更新**: 2026-01-17
**维护者**: CCG Team

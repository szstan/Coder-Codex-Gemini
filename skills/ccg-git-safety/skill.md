---
name: ccg-git-safety
description: |
  Git å®‰å…¨æ£€æŸ¥ç‚¹æœºåˆ¶ï¼Œåœ¨ AI æ”¹åŠ¨ä»£ç å‰è‡ªåŠ¨åˆ›å»ºå®‰å…¨ç‚¹ï¼Œé˜²æ­¢ä»£ç è¢«ç ´åæ— æ³•æ¢å¤ã€‚
  Use when: è°ƒç”¨ Coder/Gemini æ”¹åŠ¨ä»£ç å‰å¿…é¡»æ‰§è¡Œã€‚
category: Safety
tags: [git, safety, checkpoint, rollback, stash]
---

# CCG Git å®‰å…¨æ£€æŸ¥ç‚¹

> **ç”¨é€”**ï¼šåœ¨ AI æ”¹åŠ¨ä»£ç å‰è‡ªåŠ¨åˆ›å»º Git å®‰å…¨ç‚¹ï¼Œç¡®ä¿å¯ä»¥éšæ—¶å›é€€

## æ ¸å¿ƒé—®é¢˜

**AI æ”¹åŠ¨ä»£ç çš„é£é™©**ï¼š
- âŒ AI å¯èƒ½"ä¹±å†™"ä»£ç ï¼Œç ´åç°æœ‰åŠŸèƒ½
- âŒ å¦‚æœæ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶ä¿æŠ¤ï¼Œæ— æ³•æ¢å¤
- âŒ ç”¨æˆ·å¯èƒ½ä¸¢å¤±ä¹‹å‰çš„å·¥ä½œæˆæœ
- âŒ éš¾ä»¥è¿½æº¯é—®é¢˜æ¥æº

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… æ”¹åŠ¨å‰è‡ªåŠ¨åˆ›å»º Git stash å®‰å…¨ç‚¹
- âœ… è®°å½•å®‰å…¨ç‚¹ä¿¡æ¯åˆ°çŠ¶æ€æ–‡ä»¶
- âœ… æä¾›æ¸…æ™°çš„å›é€€æŒ‡å¯¼
- âœ… ç”¨æˆ·å®Œå…¨æ§åˆ¶ commit æ—¶æœº

---

## å¼ºåˆ¶è§„åˆ™

**åœ¨è°ƒç”¨ Coder/Gemini æ”¹åŠ¨ä»£ç å‰ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥**ï¼š

1. **æ£€æŸ¥æ˜¯å¦åœ¨ Git ä»“åº“ä¸­**
2. **æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ”¹åŠ¨**
3. **åˆ›å»º Git stash å®‰å…¨ç‚¹**
4. **è®°å½•å®‰å…¨ç‚¹ä¿¡æ¯**

**è¿è§„å³ç»ˆæ­¢**ï¼šæœªåˆ›å»ºå®‰å…¨ç‚¹å°±æ‰§è¡Œæ”¹åŠ¨ = **ä¸¥é‡å®‰å…¨è¿è§„**

---

## æ‰§è¡Œæµç¨‹

### æ­¥éª¤ 1ï¼šæ£€æŸ¥ Git ä»“åº“ï¼ˆ30 ç§’ï¼‰

```bash
# æ£€æŸ¥æ˜¯å¦åœ¨ Git ä»“åº“ä¸­
git rev-parse --is-inside-work-tree
```

**å¦‚æœä¸åœ¨ Git ä»“åº“ä¸­**ï¼š
- è­¦å‘Šç”¨æˆ·ï¼šæ­¤é¡¹ç›®æœªä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶
- å»ºè®®ï¼šåˆå§‹åŒ– Git ä»“åº“ï¼ˆ`git init`ï¼‰
- è¯¢é—®ï¼šæ˜¯å¦ç»§ç»­ï¼ˆé£é™©è‡ªè´Ÿï¼‰

### æ­¥éª¤ 2ï¼šæ£€æŸ¥å·¥ä½œåŒºçŠ¶æ€ï¼ˆ30 ç§’ï¼‰

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ”¹åŠ¨
git status --porcelain
```

**è¾“å‡ºè§£é‡Š**ï¼š
- ç©ºè¾“å‡ºï¼šå·¥ä½œåŒºå¹²å‡€ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºå®‰å…¨ç‚¹
- æœ‰è¾“å‡ºï¼šæœ‰æœªæäº¤çš„æ”¹åŠ¨ï¼Œéœ€è¦åˆ›å»º stash

### æ­¥éª¤ 3ï¼šåˆ›å»º Git Stash å®‰å…¨ç‚¹ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# åˆ›å»º stashï¼ŒåŒ…å«æœªè·Ÿè¸ªæ–‡ä»¶
git stash push -u -m "CCG-Safety: Before AI changes at $(date +%Y%m%d-%H%M%S)"
```

**å‚æ•°è¯´æ˜**ï¼š
- `-u`ï¼šåŒ…å«æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼ˆuntrackedï¼‰
- `-m`ï¼šæ·»åŠ æè¿°ä¿¡æ¯
- æ ¼å¼ï¼š`CCG-Safety: Before AI changes at 20260117-143022`

**è·å– stash å¼•ç”¨**ï¼š
```bash
# è·å–æœ€æ–°çš„ stash å¼•ç”¨
git stash list | head -n 1
# è¾“å‡ºç¤ºä¾‹ï¼šstash@{0}: On main: CCG-Safety: Before AI changes at 20260117-143022
```

### æ­¥éª¤ 4ï¼šè®°å½•å®‰å…¨ç‚¹ä¿¡æ¯ï¼ˆ1 åˆ†é’Ÿï¼‰

å°†å®‰å…¨ç‚¹ä¿¡æ¯è®°å½•åˆ° `.ccg/state.json`ï¼š

```json
{
  "git_safety": {
    "last_checkpoint": {
      "type": "stash",
      "ref": "stash@{0}",
      "timestamp": "2026-01-17T14:30:22Z",
      "message": "CCG-Safety: Before AI changes at 20260117-143022",
      "before_action": "coder execution"
    },
    "checkpoint_history": [
      {
        "ref": "stash@{0}",
        "timestamp": "2026-01-17T14:30:22Z",
        "action": "coder execution"
      }
    ]
  }
}
```

### æ­¥éª¤ 5ï¼šæ˜¾ç¤ºå®‰å…¨æç¤ºï¼ˆ30 ç§’ï¼‰

å‘ç”¨æˆ·æ˜¾ç¤ºï¼š

```
âœ… Git å®‰å…¨æ£€æŸ¥ç‚¹å·²åˆ›å»º
ğŸ“ å®‰å…¨ç‚¹ï¼šstash@{0}
â° æ—¶é—´ï¼š2026-01-17 14:30:22
ğŸ“ æè¿°ï¼šCCG-Safety: Before AI changes at 20260117-143022

å¦‚æœ AI æ”¹åŠ¨ä¸æ»¡æ„ï¼Œå¯ä»¥éšæ—¶å›é€€ï¼š
  git stash pop stash@{0}
```

---

## å›é€€æŒ‡å¯¼

### åœºæ™¯ 1ï¼šAI æ”¹åŠ¨ä¸æ»¡æ„ï¼Œæƒ³å®Œå…¨å›é€€

```bash
# æ–¹å¼ 1ï¼šåº”ç”¨ stash å¹¶åˆ é™¤ï¼ˆæ¨èï¼‰
git stash pop stash@{0}

# æ–¹å¼ 2ï¼šåº”ç”¨ stash ä½†ä¿ç•™ï¼ˆæ›´å®‰å…¨ï¼‰
git stash apply stash@{0}

# æ–¹å¼ 3ï¼šæŸ¥çœ‹ stash å†…å®¹åå†å†³å®š
git stash show -p stash@{0}
```

### åœºæ™¯ 2ï¼šAI æ”¹åŠ¨éƒ¨åˆ†æ»¡æ„ï¼Œæƒ³é€‰æ‹©æ€§å›é€€

```bash
# 1. å…ˆæŸ¥çœ‹æ”¹åŠ¨äº†å“ªäº›æ–‡ä»¶
git status

# 2. å¯¹ç‰¹å®šæ–‡ä»¶å›é€€
git checkout stash@{0} -- path/to/file.py

# 3. æˆ–è€…ä½¿ç”¨äº¤äº’å¼å›é€€
git checkout -p stash@{0}
```

### åœºæ™¯ 3ï¼šæƒ³æŸ¥çœ‹æ‰€æœ‰å®‰å…¨ç‚¹

```bash
# åˆ—å‡ºæ‰€æœ‰ CCG å®‰å…¨ç‚¹
git stash list | grep "CCG-Safety"
```

### åœºæ™¯ 4ï¼šæ¸…ç†æ—§çš„å®‰å…¨ç‚¹

```bash
# åˆ é™¤ç‰¹å®šçš„ stash
git stash drop stash@{2}

# æ¸…ç†æ‰€æœ‰ stashï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
git stash clear
```

---

## é›†æˆåˆ°å·¥ä½œæµ

### åœ¨ ccg-workflow ä¸­é›†æˆ

**è°ƒç”¨ Coder å‰**ï¼š
```
1. ç”¨æˆ·è¯·æ±‚æ”¹åŠ¨ä»£ç 
2. Claude è°ƒç”¨ /ccg-git-safety
3. åˆ›å»ºå®‰å…¨ç‚¹
4. è°ƒç”¨ Coder æ‰§è¡Œæ”¹åŠ¨
5. Claude éªŒæ”¶
```

### åœ¨ gemini-collaboration ä¸­é›†æˆ

**è°ƒç”¨ Gemini å‰**ï¼š
```
1. ç”¨æˆ·è¯·æ±‚ Gemini å®ç°åŠŸèƒ½
2. Claude è°ƒç”¨ /ccg-git-safety
3. åˆ›å»ºå®‰å…¨ç‚¹
4. è°ƒç”¨ Gemini æ‰§è¡Œæ”¹åŠ¨
5. Claude éªŒæ”¶
```

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæ­£å¸¸æµç¨‹

```
ç”¨æˆ·ï¼š"ç”¨ Coder æ·»åŠ ç™»å½•åŠŸèƒ½"
  â†“
Claudeï¼šè°ƒç”¨ /ccg-git-safety
  â†“
æ£€æŸ¥ Git çŠ¶æ€ï¼šæœ‰æœªæäº¤æ”¹åŠ¨
  â†“
åˆ›å»º stashï¼šCCG-Safety-20260117-143022
  â†“
æ˜¾ç¤ºï¼šâœ… å®‰å…¨ç‚¹å·²åˆ›å»º stash@{0}
  â†“
è°ƒç”¨ Coder æ‰§è¡Œæ”¹åŠ¨
  â†“
Claude éªŒæ”¶ï¼šä»£ç è´¨é‡è‰¯å¥½
  â†“
æç¤ºç”¨æˆ·ï¼šæ»¡æ„å¯ä»¥ commitï¼Œä¸æ»¡æ„å¯ä»¥ git stash pop
```

### ç¤ºä¾‹ 2ï¼šå›é€€æµç¨‹

```
ç”¨æˆ·ï¼š"Coder æ”¹çš„ä»£ç æœ‰é—®é¢˜ï¼Œæˆ‘æƒ³å›é€€"
  â†“
Claudeï¼šæä¾›å›é€€æŒ‡å¯¼
  â†“
ç”¨æˆ·æ‰§è¡Œï¼šgit stash pop stash@{0}
  â†“
ç»“æœï¼šä»£ç æ¢å¤åˆ°æ”¹åŠ¨å‰çš„çŠ¶æ€
  â†“
ç”¨æˆ·ï¼šé‡æ–°æè¿°éœ€æ±‚ï¼Œå†æ¬¡å°è¯•
```

### ç¤ºä¾‹ 3ï¼šé Git ä»“åº“è­¦å‘Š

```
ç”¨æˆ·ï¼š"ç”¨ Coder æ·»åŠ åŠŸèƒ½"
  â†“
Claudeï¼šè°ƒç”¨ /ccg-git-safety
  â†“
æ£€æŸ¥ï¼šä¸åœ¨ Git ä»“åº“ä¸­
  â†“
è­¦å‘Šï¼šâš ï¸ æ­¤é¡¹ç›®æœªä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶
å»ºè®®ï¼šåˆå§‹åŒ– Git ä»“åº“ï¼ˆgit initï¼‰
è¯¢é—®ï¼šæ˜¯å¦ç»§ç»­ï¼ˆé£é™©è‡ªè´Ÿï¼‰
  â†“
ç”¨æˆ·é€‰æ‹©ï¼š
  - é€‰æ‹© 1ï¼šå…ˆåˆå§‹åŒ– Gitï¼Œå†ç»§ç»­
  - é€‰æ‹© 2ï¼šé£é™©è‡ªè´Ÿï¼Œç›´æ¥ç»§ç»­
```

---

## æ³¨æ„äº‹é¡¹

### 1. Stash çš„å±€é™æ€§

**Stash ä¸æ˜¯æ°¸ä¹…å¤‡ä»½**ï¼š
- Stash å¯èƒ½è¢«æ„å¤–æ¸…é™¤ï¼ˆ`git stash clear`ï¼‰
- å»ºè®®å®šæœŸ commit é‡è¦æ”¹åŠ¨
- å¯¹äºå…³é”®åŠŸèƒ½ï¼Œå»ºè®®ä½¿ç”¨åˆ†æ”¯å¼€å‘

### 2. å®‰å…¨ç‚¹æ•°é‡ç®¡ç†

**å»ºè®®ä¿ç•™æœ€è¿‘ 5 ä¸ªå®‰å…¨ç‚¹**ï¼š
```bash
# æŸ¥çœ‹ stash æ•°é‡
git stash list | grep "CCG-Safety" | wc -l

# å¦‚æœè¶…è¿‡ 5 ä¸ªï¼Œæç¤ºç”¨æˆ·æ¸…ç†
```

### 3. ä¸ç”¨æˆ· commit çš„å…³ç³»

**å®‰å…¨ç‚¹ä¸æ›¿ä»£ commit**ï¼š
- å®‰å…¨ç‚¹ï¼šä¸´æ—¶ä¿æŠ¤ï¼Œé˜²æ­¢ AI ç ´åä»£ç 
- Commitï¼šæ°¸ä¹…è®°å½•ï¼Œç”¨æˆ·ä¸»åŠ¨ä¿å­˜å·¥ä½œæˆæœ
- ç”¨æˆ·åº”è¯¥åœ¨æ»¡æ„åæ‰‹åŠ¨ commit

### 4. ç‰¹æ®Šæƒ…å†µå¤„ç†

**å¦‚æœå·¥ä½œåŒºå·²ç»å¾ˆä¹±**ï¼š
- å»ºè®®ç”¨æˆ·å…ˆæ‰‹åŠ¨ commit æˆ– stash
- ç„¶åå†è°ƒç”¨ AI æ”¹åŠ¨
- é¿å…æ··æ·†ä¸åŒæ¥æºçš„æ”¹åŠ¨

---

## ç›¸å…³æ–‡æ¡£

- **CCG å·¥ä½œæµ**ï¼š`/ccg-workflow` Skill
- **Gemini åä½œ**ï¼š`/gemini-collaboration` Skill
- **é…ç½®æ£€æŸ¥ç‚¹**ï¼š`/ccg-checkpoint` Skill
- **çŠ¶æ€æ–‡ä»¶**ï¼š`.ccg/state.json`
- **é¡¹ç›®é…ç½®**ï¼š`.ccg/devconfig.yaml`

---

## å¿«é€Ÿå‚è€ƒ

### åˆ›å»ºå®‰å…¨ç‚¹
```bash
git stash push -u -m "CCG-Safety: Before AI changes at $(date +%Y%m%d-%H%M%S)"
```

### æŸ¥çœ‹å®‰å…¨ç‚¹
```bash
git stash list | grep "CCG-Safety"
```

### å›é€€æ”¹åŠ¨
```bash
git stash pop stash@{0}
```

### æ¸…ç†å®‰å…¨ç‚¹
```bash
git stash drop stash@{N}
```


---
name: ccg-plan
description: |
  生成详细的实施计划，支持规划与执行分离。
  Use when: 需要为复杂任务生成详细计划，允许用户审查和修改后再执行。
  生成的计划保存到 ai/plans/ 目录，可在新会话中执行。
---

# CCG 规划生成器

## 功能定位

**规划与执行分离**：将任务规划和执行解耦，提供以下价值：
- ✅ 用户可以审查和修改计划
- ✅ 计划可以在新会话中执行（避免上下文丢失）
- ✅ 计划可以复用和分享
- ✅ 支持迭代优化计划

---

## 使用方式

### 基本用法

```
/ccg:plan 实现用户认证功能
```

### 高级用法

```
/ccg:plan 实现用户认证功能
- 使用 JWT token
- 支持邮箱和密码登录
- 响应时间 < 200ms
```

---

## 规划生成流程

### 第一步：需求分析

**Claude 需要做的**：
1. 理解用户需求
2. 识别任务类型（新功能/Bug修复/性能优化/重构）
3. 评估任务复杂度
4. 确定是否需要创建 Contract

### 第二步：技术调研

**如果需要，Claude 应该**：
1. 使用 Ace MCP 搜索相关代码
2. 阅读相关文件了解现有实现
3. 识别受影响的模块和文件
4. 评估技术风险

### 第三步：生成计划

**计划应包含**：
1. **任务概述**：简要描述任务目标
2. **技术方案**：选择的技术栈和实现方式
3. **实施步骤**：详细的执行步骤（5-10步）
4. **文件清单**：需要修改的文件列表
5. **测试策略**：测试类型和覆盖率目标
6. **验收标准**：可验证的完成标准
7. **风险评估**：潜在风险和缓解措施

### 第四步：保存计划

**保存位置**：`ai/plans/<task-name>.md`

**文件命名规则**：
- 使用小写字母和连字符
- 简短描述任务
- 示例：`user-authentication.md`, `fix-login-bug.md`, `optimize-query.md`

---

## 计划模板

计划文件应遵循以下模板：

```markdown
# 实施计划：<任务名称>

**生成时间**：<时间戳>
**任务类型**：<新功能/Bug修复/性能优化/重构>
**复杂度**：<简单/中等/复杂>
**预估工作量**：<小时数>

---

## 1. 任务概述

### 1.1 目标
<简要描述任务目标>

### 1.2 背景
<任务背景和动机>

### 1.3 范围
<明确任务范围，包括做什么和不做什么>

---

## 2. 技术方案

### 2.1 技术选型
- 编程语言：<语言>
- 框架：<框架>
- 数据库：<数据库>
- 其他依赖：<依赖列表>

### 2.2 架构设计
<架构图或文字描述>

### 2.3 关键技术点
- 技术点 1：<说明>
- 技术点 2：<说明>

---

## 3. 实施步骤

### Step 1: <步骤名称>
**目标**：<步骤目标>
**操作**：
1. <具体操作1>
2. <具体操作2>

**输出**：<步骤输出>
**验证**：<如何验证步骤完成>

### Step 2: <步骤名称>
...

---

## 4. 文件清单

### 4.1 需要修改的文件
- `path/to/file1.py`：<修改目的>
- `path/to/file2.py`：<修改目的>

### 4.2 需要创建的文件
- `path/to/new_file.py`：<文件用途>

### 4.3 不修改的文件（明确排除）
- `path/to/excluded_file.py`：<为什么不修改>

---

## 5. 测试策略

### 5.1 单元测试
- 测试范围：<范围>
- 覆盖率目标：<百分比>
- 测试文件：<文件列表>

### 5.2 集成测试
- 测试范围：<范围>
- 覆盖率目标：<百分比>

### 5.3 E2E 测试（如需要）
- 测试场景：<场景列表>

---

## 6. 验收标准

- [ ] 标准 1：<可验证的标准>
- [ ] 标准 2：<可验证的标准>
- [ ] 标准 3：<可验证的标准>
- [ ] 所有测试通过
- [ ] 覆盖率达标
- [ ] Codex 审核通过

---

## 7. 风险评估

### 7.1 技术风险
- 风险 1：<描述>
  - 影响：<影响程度>
  - 缓解措施：<措施>

### 7.2 兼容性风险
- 风险 1：<描述>
  - 影响：<影响程度>
  - 缓解措施：<措施>

---

## 8. 依赖和前置条件

### 8.1 依赖项
- 依赖 1：<说明>

### 8.2 前置条件
- 条件 1：<说明>

---

## 9. 执行说明

### 9.1 执行命令
```bash
/ccg:execute ai/plans/<task-name>.md
```

### 9.2 注意事项
- 注意事项 1
- 注意事项 2

---

## 10. 变更记录

| 时间 | 修改人 | 修改内容 |
|------|--------|---------|
| <时间> | <修改人> | 初始版本 |
```

---

## Claude 的职责

### 在生成计划时

1. **充分调研**：
   - 使用 Ace MCP 搜索相关代码
   - 阅读相关文件了解现有实现
   - 不要凭空猜测，要基于实际代码

2. **详细规划**：
   - 每个步骤都要具体可执行
   - 明确每个步骤的输入输出
   - 提供验证方法

3. **风险识别**：
   - 识别潜在的技术风险
   - 识别兼容性风险
   - 提供缓解措施

4. **保存计划**：
   - 使用 Write 工具保存到 `ai/plans/<task-name>.md`
   - 文件名使用小写字母和连字符
   - 告知用户计划保存位置

### 生成计划后

**向用户报告**：
```markdown
✅ 实施计划已生成

**计划文件**：`ai/plans/<task-name>.md`

**下一步**：
1. 请审查计划，如有需要可以修改
2. 审查通过后，执行以下命令开始实施：
   ```
   /ccg:execute ai/plans/<task-name>.md
   ```

**计划概要**：
- 任务类型：<类型>
- 复杂度：<复杂度>
- 实施步骤：<步骤数>
- 需要修改的文件：<文件数>
```

---

## 示例

### 示例 1：简单任务

**用户输入**：
```
/ccg:plan 修复登录页面的拼写错误
```

**Claude 生成的计划**：
- 任务类型：Bug修复
- 复杂度：简单
- 实施步骤：2步
- 文件清单：1个文件
- 测试策略：无需新增测试

### 示例 2：中等任务

**用户输入**：
```
/ccg:plan 实现用户登录功能
```

**Claude 生成的计划**：
- 任务类型：新功能
- 复杂度：中等
- 实施步骤：6步
- 文件清单：3个文件（2个修改，1个新增）
- 测试策略：单元测试 + 集成测试

### 示例 3：复杂任务

**用户输入**：
```
/ccg:plan 优化数据库查询性能
```

**Claude 生成的计划**：
- 任务类型：性能优化
- 复杂度：复杂
- 实施步骤：8步
- 文件清单：5个文件
- 测试策略：单元测试 + 集成测试 + 性能测试

---

## 最佳实践

### 1. 计划粒度

**好的计划**：
- ✅ 每个步骤都具体可执行
- ✅ 步骤之间有清晰的依赖关系
- ✅ 每个步骤都有验证方法

**不好的计划**：
- ❌ 步骤过于笼统（如"实现功能"）
- ❌ 缺少验证方法
- ❌ 步骤之间依赖不清晰

### 2. 文件清单

**好的文件清单**：
- ✅ 列出所有需要修改的文件
- ✅ 说明每个文件的修改目的
- ✅ 明确排除不修改的文件

**不好的文件清单**：
- ❌ 只列出文件名，不说明目的
- ❌ 遗漏需要修改的文件
- ❌ 没有明确排除范围

### 3. 测试策略

**好的测试策略**：
- ✅ 明确测试类型和范围
- ✅ 设定覆盖率目标
- ✅ 列出测试文件

**不好的测试策略**：
- ❌ 只说"添加测试"
- ❌ 没有覆盖率目标
- ❌ 没有具体的测试范围

---

**文档版本**: v1.0
**最后更新**: 2026-01-17
**维护者**: CCG Team

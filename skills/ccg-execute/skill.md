---
name: ccg-execute
description: |
  执行实施计划，支持规划与执行分离。
  Use when: 需要执行已生成的实施计划，可在新会话中执行。
  读取 ai/plans/ 目录中的计划文件并按步骤执行。
---

# CCG 计划执行器

## 功能定位

**执行已生成的计划**：读取计划文件并按步骤执行，提供以下价值：
- ✅ 可在新会话中执行（避免上下文丢失）
- ✅ 严格按照计划执行，不偏离范围
- ✅ 每个步骤都有验证和检查点
- ✅ 支持断点续执行

---

## 使用方式

### 基本用法

```
/ccg:execute ai/plans/user-authentication.md
```

### 指定起始步骤

```
/ccg:execute ai/plans/user-authentication.md --from-step 3
```

---

## 执行流程

### 第一步：读取计划

**Claude 需要做的**：
1. 使用 Read 工具读取计划文件
2. 解析计划结构
3. 提取关键信息：
   - 任务概述
   - 实施步骤
   - 文件清单
   - 测试策略
   - 验收标准

### 第二步：验证计划

**检查项**：
- [ ] 计划文件格式正确
- [ ] 包含所有必需章节
- [ ] 实施步骤清晰可执行
- [ ] 文件清单完整

**如果验证失败**：
- 报告问题
- 建议用户修复计划
- 不继续执行

### 第三步：执行准备

**Claude 需要做的**：
1. 检查环境是否就绪
2. 确认所有依赖已安装
3. 创建执行日志文件：`ai/plans/logs/<task-name>-<timestamp>.log`
4. 向用户确认是否开始执行

### 第四步：逐步执行

**对于每个步骤**：
1. **显示步骤信息**：
   ```markdown
   📍 执行 Step X: <步骤名称>
   目标：<步骤目标>
   ```

2. **调用 Coder 执行**：
   - 将步骤详情注入到 Coder Prompt
   - 包含相关的约束和规范
   - 明确步骤的输入输出

3. **Claude 验收**：
   - 使用 `claude_review_checklist.md`
   - 检查是否符合步骤目标
   - 检查是否超出步骤范围

4. **记录执行结果**：
   - 记录到执行日志
   - 标记步骤状态（✅ 完成 / ❌ 失败）

5. **继续下一步或停止**：
   - 如果成功，继续下一步
   - 如果失败，停止并报告

### 第五步：测试验证

**执行完所有步骤后**：
1. 运行测试套件
2. 检查覆盖率
3. 验证所有验收标准

### 第六步：Codex 审核

**调用 Codex 审核**：
1. 将计划和执行结果传递给 Codex
2. Codex 检查是否符合计划
3. Codex 给出审核结论

### 第七步：完成报告

**生成执行报告**：
```markdown
✅ 计划执行完成

**计划文件**：`ai/plans/<task-name>.md`
**执行日志**：`ai/plans/logs/<task-name>-<timestamp>.log`

**执行摘要**：
- 总步骤数：<数量>
- 成功步骤：<数量>
- 失败步骤：<数量>
- 修改的文件：<数量>
- 测试覆盖率：<百分比>
- Codex 审核：<通过/需要修改>

**下一步**：
- [ ] 如果 Codex 审核通过，执行 Git 提交
- [ ] 如果 Codex 审核不通过，修复问题后重新执行
```

---

## 执行日志格式

执行日志保存在 `ai/plans/logs/<task-name>-<timestamp>.log`：

```markdown
# 执行日志：<任务名称>

**计划文件**：`ai/plans/<task-name>.md`
**开始时间**：<时间戳>
**结束时间**：<时间戳>
**执行状态**：<成功/失败/部分成功>

---

## Step 1: <步骤名称>

**开始时间**：<时间戳>
**状态**：✅ 完成

**执行详情**：
- Coder 调用：成功
- Claude 验收：通过
- 修改的文件：
  - `path/to/file1.py`
  - `path/to/file2.py`

**输出**：
<步骤输出>

---

## Step 2: <步骤名称>

...

---

## 测试验证

**测试结果**：✅ 通过
**覆盖率**：92%

**测试详情**：
- 单元测试：45 passed
- 集成测试：12 passed

---

## Codex 审核

**审核结果**：✅ 通过

**审核意见**：
<Codex 的审核意见>

---

## 执行摘要

- 总步骤数：6
- 成功步骤：6
- 失败步骤：0
- 修改的文件：3
- 测试覆盖率：92%
- Codex 审核：通过
```

---

## Claude 的职责

### 在执行计划时

1. **严格按照计划执行**：
   - 不偏离计划范围
   - 不添加计划之外的功能
   - 不修改计划之外的文件

2. **每步验收**：
   - 使用 `claude_review_checklist.md`
   - 确保步骤目标达成
   - 确保没有超出步骤范围

3. **详细记录**：
   - 记录每个步骤的执行详情
   - 记录修改的文件
   - 记录遇到的问题和解决方案

4. **及时报告**：
   - 每完成一个步骤，向用户报告进度
   - 遇到问题时，及时停止并报告
   - 不要静默失败

### 执行完成后

**向用户报告**：
```markdown
✅ 计划执行完成

**执行摘要**：
- 总步骤数：<数量>
- 成功步骤：<数量>
- 修改的文件：<文件列表>
- 测试覆盖率：<百分比>
- Codex 审核：<结果>

**执行日志**：`ai/plans/logs/<task-name>-<timestamp>.log`

**下一步**：
<根据 Codex 审核结果给出建议>
```

---

## 断点续执行

如果执行中断，可以从指定步骤继续：

```
/ccg:execute ai/plans/user-authentication.md --from-step 3
```

**Claude 需要做的**：
1. 读取执行日志
2. 确认前面的步骤已完成
3. 从指定步骤开始执行

---

## 错误处理

### 步骤执行失败

**处理流程**：
1. 停止执行
2. 记录错误信息到日志
3. 向用户报告：
   ```markdown
   ❌ Step X 执行失败

   **错误信息**：<错误详情>

   **建议**：
   - 检查错误原因
   - 修复问题后重新执行：
     ```
     /ccg:execute ai/plans/<task-name>.md --from-step X
     ```
   ```

### 测试失败

**处理流程**：
1. 记录测试失败信息
2. 不继续 Codex 审核
3. 向用户报告：
   ```markdown
   ❌ 测试失败

   **失败的测试**：
   - test_login: AssertionError
   - test_register: ValueError

   **建议**：
   - 修复测试失败
   - 重新运行测试
   ```

### Codex 审核不通过

**处理流程**：
1. 记录 Codex 的审核意见
2. 向用户报告：
   ```markdown
   ⚠️ Codex 审核不通过

   **审核意见**：
   <Codex 的具体意见>

   **建议**：
   - 根据 Codex 意见修复问题
   - 重新执行计划
   ```

---

**文档版本**: v1.0
**最后更新**: 2026-01-17
**维护者**: CCG Team
